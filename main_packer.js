var GOOGLEMAPS={map:'',data:[],marker:'',reports:[],posCurrent:{},options:{center:{lat:-33.443529,lng:-70.653189},zoom:6,},create:function(){var _self=this;_self.map=new google.maps.Map(document.getElementById('map'),_self.options);_self.posCurrent=_self.options.center;_self.infowindow=new google.maps.InfoWindow({maxWidth:200});var input=document.getElementById('searchBox-input');var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo('bounds',_self.map);var infowindow=new google.maps.InfoWindow();var infowindowContent=document.getElementById('infowindow-content');infowindow.setContent(infowindowContent);var marker=new google.maps.Marker({map:_self.map,anchorPoint:new google.maps.Point(0,-29)});autocomplete.addListener('place_changed',function(){infowindow.close();marker.setVisible(false);var place=autocomplete.getPlace();if(!place.geometry){window.alert("No details available for input: '"+place.name+"'");return}if(place.geometry.viewport){_self.map.fitBounds(place.geometry.viewport)}else{_self.map.setCenter(place.geometry.location);_self.map.setZoom(10)}marker.setPosition(place.geometry.location);marker.setVisible(true);var address='';if(place.address_components){address=[(place.address_components[0]&&place.address_components[0].short_name||''),(place.address_components[1]&&place.address_components[1].short_name||''),(place.address_components[2]&&place.address_components[2].short_name||'')].join(' ')}infowindowContent.children['place-icon'].src=place.icon;infowindowContent.children['place-name'].textContent=place.name;infowindowContent.children['place-address'].textContent=address;infowindow.open(_self.map,marker)})},clearMarkers:function(){let _self=this for(var i=0;i<_self.reports.length;i++){_self.reports[i].setMap(null)}_self.reports=[]},addMarkerWithTimeout(data,timeout){let _self=this;_self.clearMarkers();let contentString='<div id="content">'+'<h5 id="firstHeading" class="firstHeading"> Camara</h5>'+'<div id="bodyContent">'+data.camara+'<p class="desc">En vivo</p>'+'</div>'+'</div>';window.setTimeout(function(){let marker;marker=new google.maps.Marker({position:{lat:Number(data.lat),lng:Number(data.lng)},map:_self.map,animation:google.maps.Animation.DROP});google.maps.event.addListener(_self.map,'click',function(event){if(_self.infowindow){_self.infowindow.close()}});marker.addListener('click',function(){_self.infowindow.open(_self.map,marker);_self.infowindow.setContent(contentString)});_self.reports.push(marker)},timeout)},getData:function(){console.log('obteniendo la info');$.ajax({url:'api/v1/camara.php',dataType:'json',data:{reports:'1'},method:'post',cached:false,success:function(data){console.log(data);console.log('Success');localStorage.setItem('dataReports',JSON.stringify(data.camaras));htmlList='<i class="menu-flags flag-icon flag-icon-cl">::before</i>';for(var i=0;i<6;i++){let cam=data.ultimas[i];let htmlList1='<div class="card lis-brd-light text-center text-lg-left lis-info lis-relative">'+'<a href="#">'+'<div class="lis-grediant grediant-tb-light lis-relative modImage rounded">';let htmlList2='</div>'+'<div class="lis-absolute lis-left-20 lis-top-20  lis-icon lis-rounded-circle-50 text-center">'+'<div class="text-white mb-0 lis-line-height-2_5 h4"><i class="flag-icon flag-icon-cl"></i></div>'+'</div>'+'</a>'+'<div class="hover-text lis-absolute lis-left-20 lis-bottom-20 lis-font-roboto text-white text-left">'+'<h6 class="text-white mb-0">'+cam.ciudad+'</h6> <span class="lis-font-roboto">'+cam.pais+'</span> </div>'+'</div>';$("#mb-4"+(i+1)).html(htmlList1+cam.camara+htmlList2)}},error:function(xhr,textStatus,errorThrown){console.log(xhr);console.log(textStatus);console.log(errorThrown)}});console.log('Saliendo de geData')},printData:function(){let _self=this;$.each(_self.data,function(i,e){_self.addMarkerWithTimeout(e,i*200)})},updateData:function(){let _self=this;_self.data=JSON.parse(localStorage.getItem('dataReports'))},getNewCams:function(){console.log('Entrando getNewCams');let listaItem='';$.ajax({url:'api/v1/reports.php',dataType:'json',data:{getNewCams:'1'},method:'post',cached:false,success:function(data){for(let i in data){console.log(i,data[i]);data[i].lat;data[i].lng;listaItem+='<li><a href="javascript:toCenterMap('+data[i].lat+','+data[i].lng+')" >camara nueva </a></li>'}console.log('listaItem: '+listaItem);$(".dropdown-camsList").html(listaItem)}});console.log('Saliendo getNewCams')},setCenterMap:function(lat,lng){let _self=this console.log('latitud'+lat);console.log('longitud'+lng);let centerMap={lat:lat,lng:lng};_self.map.setCenter(centerMap)},updatePos:function(){var _self=this;_self.map.setCenter(_self.options.center);_self.map.setZoom(9);_self.posCurrent=_self.options.center},setEvent:function(){var _self=this;_self.marker.addListener('drag',function(e){_self.posCurrent={lat:e.latLng.lat(),lng:e.latLng.lng()}})},setMarker:function(){var _self=this;_self.marker=new google.maps.Marker({position:_self.options.center,animation:google.maps.Animation.DROP,map:_self.map,draggable:true,label:'P',title:'Coordenadas'})_self.setEvent()},getPos:function(){var _self=this;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){var pos={lat:-33.443529,lng:-70.653189};_self.options.center=pos;_self.updatePos()},function(){_self.handleErrorMap()})}else{_self.handleErrorMap()}},handleErrorMap:function(){var _self=this;_self.options.center={lat:-33.443529,lng:-70.653189};_self.updatePos()},getPosCurrent:function(){return this.posCurrent},init:function(){console.log("iniciando el mapa");var _self=this;_self.getPos();_self.create();_self.getData();_self.updateData();setTimeout(function(){_self.updateData()},2000);_self.setMarker();setTimeout(function(){_self.setMarker()},500)_self.printData();setTimeout(function(){_self.printData()},2000)}}var REGISTER={printInterval:null,intervalPrint:function(){let _self=this;_self.printInterval=setInterval(function(){_self.printPos()},1500)},clearIntervalPrint:function(){let _self=this;clearInterval(_self.printInterval)},printPos:function(){$('#lat').val(GOOGLEMAPS.getPosCurrent().lat);$('#lng').val(GOOGLEMAPS.getPosCurrent().lng)},upload:function(){},save:function(){let _self=this},clean:function(){$('#error').html('')},init(){let _self=this;setTimeout(function(){_self.intervalPrint()},1000);_self.save()}}$(document).ready(function(){$('[data-toggle="offcanvas"]').click(function(){$('.row-offcanvas').toggleClass('active')});GOOGLEMAPS.init();REGISTER.init();$('.newCam').click(function(){var $this=$(this);var p1=$this.data('p1');var p2=$this.data('p2');console.log(p1);console.log(p2)})});